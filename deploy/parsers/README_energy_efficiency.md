# 에너지 소비효율 파서 (Energy Efficiency Parser)

## 개요

에너지 소비효율 등급 정보를 파싱하는 파서입니다. 다양한 형식의 등급 표기를 처리하여 최종 등급 숫자(1-5)를 추출합니다.

## Goal 값

```
'소비효율'
```

## 처리 가능한 형식

### 1. 기본 등급 형식
- `3등급 (21.10.1일 부 에너지등급 개정 기준)` → **3**
- `4등급 (21.10.1일 부 에너지등급 개정 기준)` → **4**
- `1등급 (21.10.1일 부 에너지등급 개정 기준)` → **1**
- `2등급(21.10.1일 부 에너지등급 개정 기준)` → **2**

### 2. 개정 전후 등급 (화살표 포함)
개정 전후 등급이 있는 경우, **개정 후** 등급을 추출합니다.

- `(개정 전) 1등급 → (23.5.1일 부 개정 기준) 2등급` → **2**
- `(개정 전) 4등급 → (23.5.1일 부 개정 기준) 3등급` → **3**
- `1등급(구효율등급)→3등급(23.5.1일 부 개정 기준)` → **3**

### 3. 간단한 등급 표기
- `1 등급` → **1**
- `5등급` → **5**

### 4. 숫자만 있는 경우
- `1` → **1**
- `5` → **5**

## 스킵되는 패턴

다음 패턴들은 파싱하지 않고 스킵합니다:

- `최저소비효율기준 만족`
- `최저소비효율`
- `등급 外`
- `등급外`
- `무등급`
- `해당없음`
- `해당 없음`

## 출력 형식

```python
{
    'goal': '소비효율',
    'target_disp_nm2': '에너지 소비효율',
    'dimension_type': None,
    'parsed_value': 3.0  # float 타입
}
```

## 사용 방법

### 1. 파이프라인에서 사용

```bash
# 기본 실행
python transform_spec_size.py --goal 소비효율

# 기존 데이터 삭제 후 실행
python transform_spec_size.py --goal 소비효율 --truncate

# 간략한 출력
python transform_spec_size.py --goal 소비효율 --quiet
```

### 2. Python 코드에서 직접 사용

```python
import pandas as pd
from parsers import get_parser

# 파서 가져오기
parser = get_parser('소비효율')

# 데이터 준비
row = pd.Series({
    'value': '(개정 전) 1등급 → (23.5.1일 부 개정 기준) 2등급',
    'mdl_code': 'ABC123',
    'goods_nm': '삼성 냉장고',
    'disp_nm2': '에너지 소비효율',
    # ... 기타 필드
})

# 파싱 실행
parsed_rows, success, needs_check = parser.parse(row)

if success:
    print(f"파싱 결과: {parsed_rows[0]['parsed_value']}")  # 2.0
```

## 테스트

테스트 스크립트를 실행하여 파서 동작을 확인할 수 있습니다:

```bash
python test_energy_efficiency_parser.py
```

## 구현 상세

### 파싱 로직 순서

1. **스킵 패턴 확인**: 먼저 스킵해야 하는 패턴인지 확인
2. **화살표(→) 처리**: 화살표가 있으면 개정 후 등급(화살표 뒤) 추출
3. **"N등급" 패턴**: 텍스트에서 마지막에 나오는 등급 숫자 추출
4. **단독 숫자**: 1-5 사이의 독립적인 숫자 추출 (날짜/괄호 제외)

### 등급 범위

- 추출되는 등급은 **1-5** 사이의 정수만 유효합니다.
- 범위를 벗어나는 숫자는 무시됩니다.

## 주의사항

- `dimension_type`은 요구사항에 따라 `None`으로 설정됩니다.
- `parsed_value`는 float 타입으로 저장됩니다.
- 개정 전후 등급이 있는 경우, 항상 **개정 후**(화살표 뒤) 등급을 추출합니다.
